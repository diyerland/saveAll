'use strict';

module.exports = function (options) {
  return function (query, queryOptions) {
    if (!queryOptions) {
      return query;
    }

    if (queryOptions.query) {
      query.where(queryOptions.query);
    }

    if (queryOptions.skip) {
      query.skip(queryOptions.skip);
    }

    if (options.limit && (!queryOptions.limit || queryOptions.limit === '0' || queryOptions.limit > options.limit)) {
      queryOptions.limit = options.limit;
    }

    if (queryOptions.limit && query.op !== 'count' && !queryOptions.distinct) {
      query.limit(queryOptions.limit);
    }

    if (queryOptions.sort) {
      query.sort(queryOptions.sort);
    }

    if (queryOptions.populate) {
      query.populate(queryOptions.populate);
    }

    if (queryOptions.select) {
      query.select(queryOptions.select);
    }

    if (queryOptions.distinct) {
      query.distinct(queryOptions.distinct);
    }

    return query;
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9idWlsZFF1ZXJ5LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxPQUFQLEdBQWlCLFVBQVUsT0FBVixFQUFtQjtBQUNsQyxTQUFPLFVBQVUsS0FBVixFQUFpQixZQUFqQixFQUErQjtBQUNwQyxRQUFJLENBQUMsWUFBRCxFQUFlO0FBQ2pCLGFBQU8sS0FBUCxDQURpQjtLQUFuQjs7QUFJQSxRQUFJLGFBQWEsS0FBYixFQUFvQjtBQUN0QixZQUFNLEtBQU4sQ0FBWSxhQUFhLEtBQWIsQ0FBWixDQURzQjtLQUF4Qjs7QUFJQSxRQUFJLGFBQWEsSUFBYixFQUFtQjtBQUNyQixZQUFNLElBQU4sQ0FBVyxhQUFhLElBQWIsQ0FBWCxDQURxQjtLQUF2Qjs7QUFJQSxRQUFJLFFBQVEsS0FBUixLQUFrQixDQUFDLGFBQWEsS0FBYixJQUFzQixhQUFhLEtBQWIsS0FBdUIsR0FBdkIsSUFBOEIsYUFBYSxLQUFiLEdBQXFCLFFBQVEsS0FBUixDQUE1RixFQUE0RztBQUM5RyxtQkFBYSxLQUFiLEdBQXFCLFFBQVEsS0FBUixDQUR5RjtLQUFoSDs7QUFJQSxRQUFJLGFBQWEsS0FBYixJQUFzQixNQUFNLEVBQU4sS0FBYSxPQUFiLElBQXdCLENBQUMsYUFBYSxRQUFiLEVBQXVCO0FBQ3hFLFlBQU0sS0FBTixDQUFZLGFBQWEsS0FBYixDQUFaLENBRHdFO0tBQTFFOztBQUlBLFFBQUksYUFBYSxJQUFiLEVBQW1CO0FBQ3JCLFlBQU0sSUFBTixDQUFXLGFBQWEsSUFBYixDQUFYLENBRHFCO0tBQXZCOztBQUlBLFFBQUksYUFBYSxRQUFiLEVBQXVCO0FBQ3pCLFlBQU0sUUFBTixDQUFlLGFBQWEsUUFBYixDQUFmLENBRHlCO0tBQTNCOztBQUlBLFFBQUksYUFBYSxNQUFiLEVBQXFCO0FBQ3ZCLFlBQU0sTUFBTixDQUFhLGFBQWEsTUFBYixDQUFiLENBRHVCO0tBQXpCOztBQUlBLFFBQUksYUFBYSxRQUFiLEVBQXVCO0FBQ3pCLFlBQU0sUUFBTixDQUFlLGFBQWEsUUFBYixDQUFmLENBRHlCO0tBQTNCOztBQUlBLFdBQU8sS0FBUCxDQXJDb0M7R0FBL0IsQ0FEMkI7Q0FBbkIiLCJmaWxlIjoiYnVpbGRRdWVyeS5qcyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICByZXR1cm4gZnVuY3Rpb24gKHF1ZXJ5LCBxdWVyeU9wdGlvbnMpIHtcclxuICAgIGlmICghcXVlcnlPcHRpb25zKSB7XHJcbiAgICAgIHJldHVybiBxdWVyeVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMucXVlcnkpIHtcclxuICAgICAgcXVlcnkud2hlcmUocXVlcnlPcHRpb25zLnF1ZXJ5KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMuc2tpcCkge1xyXG4gICAgICBxdWVyeS5za2lwKHF1ZXJ5T3B0aW9ucy5za2lwKVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChvcHRpb25zLmxpbWl0ICYmICghcXVlcnlPcHRpb25zLmxpbWl0IHx8IHF1ZXJ5T3B0aW9ucy5saW1pdCA9PT0gJzAnIHx8IHF1ZXJ5T3B0aW9ucy5saW1pdCA+IG9wdGlvbnMubGltaXQpKSB7XHJcbiAgICAgIHF1ZXJ5T3B0aW9ucy5saW1pdCA9IG9wdGlvbnMubGltaXRcclxuICAgIH1cclxuXHJcbiAgICBpZiAocXVlcnlPcHRpb25zLmxpbWl0ICYmIHF1ZXJ5Lm9wICE9PSAnY291bnQnICYmICFxdWVyeU9wdGlvbnMuZGlzdGluY3QpIHtcclxuICAgICAgcXVlcnkubGltaXQocXVlcnlPcHRpb25zLmxpbWl0KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMuc29ydCkge1xyXG4gICAgICBxdWVyeS5zb3J0KHF1ZXJ5T3B0aW9ucy5zb3J0KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMucG9wdWxhdGUpIHtcclxuICAgICAgcXVlcnkucG9wdWxhdGUocXVlcnlPcHRpb25zLnBvcHVsYXRlKVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMuc2VsZWN0KSB7XHJcbiAgICAgIHF1ZXJ5LnNlbGVjdChxdWVyeU9wdGlvbnMuc2VsZWN0KVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChxdWVyeU9wdGlvbnMuZGlzdGluY3QpIHtcclxuICAgICAgcXVlcnkuZGlzdGluY3QocXVlcnlPcHRpb25zLmRpc3RpbmN0KVxyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBxdWVyeVxyXG4gIH1cclxufVxyXG4iXX0=
//# sourceMappingURL=buildQuery.js.map