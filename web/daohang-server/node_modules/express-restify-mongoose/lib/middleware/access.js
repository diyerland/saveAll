'use strict';

module.exports = function (options) {
  var errorHandler = require('../errorHandler')(options);

  return function (req, res, next) {
    var handler = function handler(err, access) {
      if (err) {
        return errorHandler(req, res, next)(err);
      }

      if (['public', 'private', 'protected'].indexOf(access) < 0) {
        throw new Error('Unsupported access, must be "private", "protected" or "public"');
      }

      req.access = access;
      next();
    };

    if (options.access.length > 1) {
      options.access(req, handler);
    } else {
      handler(null, options.access(req));
    }
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2FjY2Vzcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLE9BQU8sT0FBUCxHQUFpQixVQUFVLE9BQVYsRUFBbUI7QUFDbEMsTUFBTSxlQUFlLFFBQVEsaUJBQVIsRUFBMkIsT0FBM0IsQ0FBZixDQUQ0Qjs7QUFHbEMsU0FBTyxVQUFVLEdBQVYsRUFBZSxHQUFmLEVBQW9CLElBQXBCLEVBQTBCO0FBQy9CLFFBQU0sVUFBVSxTQUFWLE9BQVUsQ0FBVSxHQUFWLEVBQWUsTUFBZixFQUF1QjtBQUNyQyxVQUFJLEdBQUosRUFBUztBQUNQLGVBQU8sYUFBYSxHQUFiLEVBQWtCLEdBQWxCLEVBQXVCLElBQXZCLEVBQTZCLEdBQTdCLENBQVAsQ0FETztPQUFUOztBQUlBLFVBQUksQ0FBQyxRQUFELEVBQVcsU0FBWCxFQUFzQixXQUF0QixFQUFtQyxPQUFuQyxDQUEyQyxNQUEzQyxJQUFxRCxDQUFyRCxFQUF3RDtBQUMxRCxjQUFNLElBQUksS0FBSixDQUFVLGdFQUFWLENBQU4sQ0FEMEQ7T0FBNUQ7O0FBSUEsVUFBSSxNQUFKLEdBQWEsTUFBYixDQVRxQztBQVVyQyxhQVZxQztLQUF2QixDQURlOztBQWMvQixRQUFJLFFBQVEsTUFBUixDQUFlLE1BQWYsR0FBd0IsQ0FBeEIsRUFBMkI7QUFDN0IsY0FBUSxNQUFSLENBQWUsR0FBZixFQUFvQixPQUFwQixFQUQ2QjtLQUEvQixNQUVPO0FBQ0wsY0FBUSxJQUFSLEVBQWMsUUFBUSxNQUFSLENBQWUsR0FBZixDQUFkLEVBREs7S0FGUDtHQWRLLENBSDJCO0NBQW5CIiwiZmlsZSI6ImFjY2Vzcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcclxuICBjb25zdCBlcnJvckhhbmRsZXIgPSByZXF1aXJlKCcuLi9lcnJvckhhbmRsZXInKShvcHRpb25zKVxyXG5cclxuICByZXR1cm4gZnVuY3Rpb24gKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgICBjb25zdCBoYW5kbGVyID0gZnVuY3Rpb24gKGVyciwgYWNjZXNzKSB7XHJcbiAgICAgIGlmIChlcnIpIHtcclxuICAgICAgICByZXR1cm4gZXJyb3JIYW5kbGVyKHJlcSwgcmVzLCBuZXh0KShlcnIpXHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGlmIChbJ3B1YmxpYycsICdwcml2YXRlJywgJ3Byb3RlY3RlZCddLmluZGV4T2YoYWNjZXNzKSA8IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vuc3VwcG9ydGVkIGFjY2VzcywgbXVzdCBiZSBcInByaXZhdGVcIiwgXCJwcm90ZWN0ZWRcIiBvciBcInB1YmxpY1wiJylcclxuICAgICAgfVxyXG5cclxuICAgICAgcmVxLmFjY2VzcyA9IGFjY2Vzc1xyXG4gICAgICBuZXh0KClcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3B0aW9ucy5hY2Nlc3MubGVuZ3RoID4gMSkge1xyXG4gICAgICBvcHRpb25zLmFjY2VzcyhyZXEsIGhhbmRsZXIpXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBoYW5kbGVyKG51bGwsIG9wdGlvbnMuYWNjZXNzKHJlcSkpXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcbiJdfQ==
//# sourceMappingURL=access.js.map