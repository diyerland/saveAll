{"version":3,"sources":["../../src/middleware/filterAndFindById.js"],"names":[],"mappings":";;;;AAAA,IAAM,OAAO,QAAQ,MAAR,CAAP;;AAEN,OAAO,OAAP,GAAiB,UAAU,KAAV,EAAiB,OAAjB,EAA0B;AACzC,MAAM,eAAe,QAAQ,iBAAR,EAA2B,OAA3B,CAAf,CADmC;;AAGzC,SAAO,UAAU,GAAV,EAAe,GAAf,EAAoB,IAApB,EAA0B;AAC/B,QAAI,CAAC,IAAI,MAAJ,CAAW,EAAX,EAAe;AAClB,aAAO,MAAP,CADkB;KAApB;;AAIA,YAAQ,aAAR,CAAsB,KAAtB,EAA6B,GAA7B,EAAkC,UAAC,eAAD,EAAqB;AACrD,sBAAgB,OAAhB,GAA0B,GAA1B,qBACG,QAAQ,UAAR,EAAqB,IAAI,MAAJ,CAAW,EAAX,CADxB,EAEG,IAFH,CAEQ,KAFR,EAEe,IAFf,CAEoB,QAAQ,cAAR,CAFpB,CAE4C,IAF5C,GAEmD,IAFnD,CAEwD,UAAC,GAAD,EAAS;AAC/D,YAAI,CAAC,GAAD,EAAM;AACR,iBAAO,aAAa,GAAb,EAAkB,GAAlB,EAAuB,IAAvB,EAA6B,IAAI,KAAJ,CAAU,KAAK,YAAL,CAAkB,GAAlB,CAAV,CAA7B,CAAP,CADQ;SAAV;;AAIA,YAAI,GAAJ,CAAQ,QAAR,GAAmB,GAAnB,CAL+D;;AAO/D,eAP+D;OAAT,EAQrD,aAAa,GAAb,EAAkB,GAAlB,EAAuB,IAAvB,CAVH,EADqD;KAArB,CAAlC,CAL+B;GAA1B,CAHkC;CAA1B","file":"filterAndFindById.js","sourcesContent":["const http = require('http')\r\n\r\nmodule.exports = function (model, options) {\r\n  const errorHandler = require('../errorHandler')(options)\r\n\r\n  return function (req, res, next) {\r\n    if (!req.params.id) {\r\n      return next()\r\n    }\r\n\r\n    options.contextFilter(model, req, (filteredContext) => {\r\n      filteredContext.findOne().and({\r\n        [options.idProperty]: req.params.id\r\n      }).lean(false).read(options.readPreference).exec().then((doc) => {\r\n        if (!doc) {\r\n          return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]))\r\n        }\r\n\r\n        req.erm.document = doc\r\n\r\n        next()\r\n      }, errorHandler(req, res, next))\r\n    })\r\n  }\r\n}\r\n"]}