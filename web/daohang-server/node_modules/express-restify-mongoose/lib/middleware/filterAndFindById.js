'use strict';

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

var http = require('http');

module.exports = function (model, options) {
  var errorHandler = require('../errorHandler')(options);

  return function (req, res, next) {
    if (!req.params.id) {
      return next();
    }

    options.contextFilter(model, req, function (filteredContext) {
      filteredContext.findOne().and(_defineProperty({}, options.idProperty, req.params.id)).lean(false).read(options.readPreference).exec().then(function (doc) {
        if (!doc) {
          return errorHandler(req, res, next)(new Error(http.STATUS_CODES[404]));
        }

        req.erm.document = doc;

        next();
      }, errorHandler(req, res, next));
    });
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9taWRkbGV3YXJlL2ZpbHRlckFuZEZpbmRCeUlkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxJQUFNLE9BQU8sUUFBUSxNQUFSLENBQVA7O0FBRU4sT0FBTyxPQUFQLEdBQWlCLFVBQVUsS0FBVixFQUFpQixPQUFqQixFQUEwQjtBQUN6QyxNQUFNLGVBQWUsUUFBUSxpQkFBUixFQUEyQixPQUEzQixDQUFmLENBRG1DOztBQUd6QyxTQUFPLFVBQVUsR0FBVixFQUFlLEdBQWYsRUFBb0IsSUFBcEIsRUFBMEI7QUFDL0IsUUFBSSxDQUFDLElBQUksTUFBSixDQUFXLEVBQVgsRUFBZTtBQUNsQixhQUFPLE1BQVAsQ0FEa0I7S0FBcEI7O0FBSUEsWUFBUSxhQUFSLENBQXNCLEtBQXRCLEVBQTZCLEdBQTdCLEVBQWtDLFVBQUMsZUFBRCxFQUFxQjtBQUNyRCxzQkFBZ0IsT0FBaEIsR0FBMEIsR0FBMUIscUJBQ0csUUFBUSxVQUFSLEVBQXFCLElBQUksTUFBSixDQUFXLEVBQVgsQ0FEeEIsRUFFRyxJQUZILENBRVEsS0FGUixFQUVlLElBRmYsQ0FFb0IsUUFBUSxjQUFSLENBRnBCLENBRTRDLElBRjVDLEdBRW1ELElBRm5ELENBRXdELFVBQUMsR0FBRCxFQUFTO0FBQy9ELFlBQUksQ0FBQyxHQUFELEVBQU07QUFDUixpQkFBTyxhQUFhLEdBQWIsRUFBa0IsR0FBbEIsRUFBdUIsSUFBdkIsRUFBNkIsSUFBSSxLQUFKLENBQVUsS0FBSyxZQUFMLENBQWtCLEdBQWxCLENBQVYsQ0FBN0IsQ0FBUCxDQURRO1NBQVY7O0FBSUEsWUFBSSxHQUFKLENBQVEsUUFBUixHQUFtQixHQUFuQixDQUwrRDs7QUFPL0QsZUFQK0Q7T0FBVCxFQVFyRCxhQUFhLEdBQWIsRUFBa0IsR0FBbEIsRUFBdUIsSUFBdkIsQ0FWSCxFQURxRDtLQUFyQixDQUFsQyxDQUwrQjtHQUExQixDQUhrQztDQUExQiIsImZpbGUiOiJmaWx0ZXJBbmRGaW5kQnlJZC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGh0dHAgPSByZXF1aXJlKCdodHRwJylcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gKG1vZGVsLCBvcHRpb25zKSB7XHJcbiAgY29uc3QgZXJyb3JIYW5kbGVyID0gcmVxdWlyZSgnLi4vZXJyb3JIYW5kbGVyJykob3B0aW9ucylcclxuXHJcbiAgcmV0dXJuIGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gICAgaWYgKCFyZXEucGFyYW1zLmlkKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KClcclxuICAgIH1cclxuXHJcbiAgICBvcHRpb25zLmNvbnRleHRGaWx0ZXIobW9kZWwsIHJlcSwgKGZpbHRlcmVkQ29udGV4dCkgPT4ge1xyXG4gICAgICBmaWx0ZXJlZENvbnRleHQuZmluZE9uZSgpLmFuZCh7XHJcbiAgICAgICAgW29wdGlvbnMuaWRQcm9wZXJ0eV06IHJlcS5wYXJhbXMuaWRcclxuICAgICAgfSkubGVhbihmYWxzZSkucmVhZChvcHRpb25zLnJlYWRQcmVmZXJlbmNlKS5leGVjKCkudGhlbigoZG9jKSA9PiB7XHJcbiAgICAgICAgaWYgKCFkb2MpIHtcclxuICAgICAgICAgIHJldHVybiBlcnJvckhhbmRsZXIocmVxLCByZXMsIG5leHQpKG5ldyBFcnJvcihodHRwLlNUQVRVU19DT0RFU1s0MDRdKSlcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlcS5lcm0uZG9jdW1lbnQgPSBkb2NcclxuXHJcbiAgICAgICAgbmV4dCgpXHJcbiAgICAgIH0sIGVycm9ySGFuZGxlcihyZXEsIHJlcywgbmV4dCkpXHJcbiAgICB9KVxyXG4gIH1cclxufVxyXG4iXX0=
//# sourceMappingURL=filterAndFindById.js.map