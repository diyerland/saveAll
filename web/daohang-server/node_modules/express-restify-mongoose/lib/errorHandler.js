'use strict';

var http = require('http');

module.exports = function (options) {
  return function (req, res, next) {
    return function (err) {
      if (err.message === http.STATUS_CODES[404] || req.params.id && err.path === options.idProperty && err.name === 'CastError') {
        req.erm.statusCode = 404;
      } else {
        req.erm.statusCode = req.erm.statusCode && req.erm.statusCode >= 400 ? req.erm.statusCode : 400;
      }

      options.onError(err, req, res, next);
    };
  };
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lcnJvckhhbmRsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFNLE9BQU8sUUFBUSxNQUFSLENBQVA7O0FBRU4sT0FBTyxPQUFQLEdBQWlCLFVBQVUsT0FBVixFQUFtQjtBQUNsQyxTQUFPLFVBQVUsR0FBVixFQUFlLEdBQWYsRUFBb0IsSUFBcEIsRUFBMEI7QUFDL0IsV0FBTyxVQUFVLEdBQVYsRUFBZTtBQUNwQixVQUFJLElBQUksT0FBSixLQUFnQixLQUFLLFlBQUwsQ0FBa0IsR0FBbEIsQ0FBaEIsSUFBMkMsSUFBSSxNQUFKLENBQVcsRUFBWCxJQUFpQixJQUFJLElBQUosS0FBYSxRQUFRLFVBQVIsSUFBc0IsSUFBSSxJQUFKLEtBQWEsV0FBYixFQUEyQjtBQUM1SCxZQUFJLEdBQUosQ0FBUSxVQUFSLEdBQXFCLEdBQXJCLENBRDRIO09BQTlILE1BRU87QUFDTCxZQUFJLEdBQUosQ0FBUSxVQUFSLEdBQXFCLElBQUksR0FBSixDQUFRLFVBQVIsSUFBc0IsSUFBSSxHQUFKLENBQVEsVUFBUixJQUFzQixHQUF0QixHQUE0QixJQUFJLEdBQUosQ0FBUSxVQUFSLEdBQXFCLEdBQXZFLENBRGhCO09BRlA7O0FBTUEsY0FBUSxPQUFSLENBQWdCLEdBQWhCLEVBQXFCLEdBQXJCLEVBQTBCLEdBQTFCLEVBQStCLElBQS9CLEVBUG9CO0tBQWYsQ0FEd0I7R0FBMUIsQ0FEMkI7Q0FBbkIiLCJmaWxlIjoiZXJyb3JIYW5kbGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgaHR0cCA9IHJlcXVpcmUoJ2h0dHAnKVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAob3B0aW9ucykge1xyXG4gIHJldHVybiBmdW5jdGlvbiAocmVxLCByZXMsIG5leHQpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgIGlmIChlcnIubWVzc2FnZSA9PT0gaHR0cC5TVEFUVVNfQ09ERVNbNDA0XSB8fCAocmVxLnBhcmFtcy5pZCAmJiBlcnIucGF0aCA9PT0gb3B0aW9ucy5pZFByb3BlcnR5ICYmIGVyci5uYW1lID09PSAnQ2FzdEVycm9yJykpIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSA0MDRcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICByZXEuZXJtLnN0YXR1c0NvZGUgPSByZXEuZXJtLnN0YXR1c0NvZGUgJiYgcmVxLmVybS5zdGF0dXNDb2RlID49IDQwMCA/IHJlcS5lcm0uc3RhdHVzQ29kZSA6IDQwMFxyXG4gICAgICB9XHJcblxyXG4gICAgICBvcHRpb25zLm9uRXJyb3IoZXJyLCByZXEsIHJlcywgbmV4dClcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl19
//# sourceMappingURL=errorHandler.js.map